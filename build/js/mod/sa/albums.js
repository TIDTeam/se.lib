/*! Copyright (c) SESHENGHUO.COM - Author: LIJUN - Email: zwlijun@gmail.com - Git: https://github.com/zwlijun/se.lib */
define(function(require,exports,module){require("mod/zepto/touch.e960be16676e977765ed45c5f7aaed29eb0160d4");var a=require("mod/sa/lightanimation.739ed5f9626be415ae5bbc5bebac5fc49c33fbd6"),b=require("mod/sa/scenetransitions.9cf7f1ec5f36a82575066dbd01a7ef4723de1362"),c=require("mod/se/listener.263f38898829bcbd37b39b7743be119a9db33581"),d=require("mod/se/util.5418ba8bf71f527f29091bc874d170aac4af716b"),e={},f={albums:{show:function(b,c){var d=c.parent(),f=d.parent(),g=f.attr("id"),h=$(f.attr("data-relative")),i=h.offset(),j=d.offset(),k=d.find('[data-type="photos"]'),l=k.attr("data-in"),m=e[g];k.css({left:i.left-j.left+"px",top:i.top-j.top+"px",width:i.width+"px",height:i.height+"px"}),m.currentIndex=0,m.photos=k,m.photoList=k.find('[data-type="photo"]'),m.createSceneTransition(),k.removeClass("hide"),m.exec("show",[]),setTimeout(function(){a.newInstance(k,l).play()},60)}}},g=function(a,b){this.id=a,this.albums=$("#"+a),this.relative=b||"body",this.albumList=this.albums.find('[data-type="album"]'),this.albumSize=this.albumList.length,this.currentIndex=0,this.nextIndex=0,this.prevIndex=0,this.lastIndex=0,this.currentZIndex=4,this.nextZIndex=3,this.prevZIndex=2,this.queueZIndex=1,this.photos=null,this.photoList=[],this.listener=new c({onshow:null,onhidden:null,onstart:null,onscrolling:null,onend:null})};g.prototype={exec:function(a,b){return this.listener.exec(a,b)},set:function(a,b){this.listener.set(a,b)},remove:function(a){this.listener.remove(a)},get:function(a){return this.listener.get(a)},clear:function(){this.listener.clear()},createSceneTransition:function(){var a=this,c=null,d=a.photos,e=a.photoList,f=d.attr("data-mode"),g=d.attr("data-scroll")||"horizontal",h=Number(d.attr("data-hidden")||"100");c=b.newInstance(e,f,g),c.set("shift",{callback:function(a,b,d,e,f,g,h,i,j,k){var l=Math.abs(e),m=Math.abs(f),n=!1,o=k.stage,p=null,q="!.5s ease-out;opacity:0!.4s ease-out";"horizontal"==i?(n=m>=j,p="transition::translate:"+(e>0?"100%,0":"-100%,0")+q):(n=l>=j,p="transition::translate:"+(f>0?"0,100%":"0,-100%")+q),n&&(o.one("webkitTransitionEnd","",{stage:o,albums:this},function(a){a.stopPropagation();var b=a.data;b.stage.addClass("hide"),b.albums.exec("hidden",[])}),o.css("opacity",0),c.restore())},context:a,args:[g,h,c]})},create:function(){var b=this,c=b.albums.attr("data-in");if(c){var g=a.newInstance(b.albums,c);g.play()}b.albums.attr("data-relative",b.relative),e[b.id]=b,d.setActionHook(b.albums),d.injectAction(f)},destroy:function(){delete e[this.id]}},module.exports={newInstance:function(a,b){var c=new g(a,b);return{set:function(a,b){return c.set(a,b),this},create:function(){return c.create(),this},destroy:function(){return c.destroy(),this}}}}});
