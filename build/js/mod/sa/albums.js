/*! Copyright (c) SESHENGHUO.COM - Author: LIJUN - Email: zwlijun@gmail.com - Git: https://github.com/zwlijun/se.lib */
define(function(require,exports,module){require("mod/zepto/touch");var a=require("mod/sa/lightanimation"),b=require("mod/sa/scenetransitions"),c=require("mod/se/listener"),d=require("mod/se/util"),e={},f={albums:{show:function(b,c){var d=c.parent(),f=d.parent(),g=f.attr("id"),h=$(f.attr("data-relative")),i=h.offset(),j=d.offset(),k=d.find('[data-type="photos"]'),l=k.attr("data-in"),m=e[g];k.css({left:i.left-j.left+"px",top:i.top-j.top+"px",width:i.width+"px",height:i.height+"px"}),m.currentIndex=0,m.photos=k,m.photoList=k.find('[data-type="photo"]'),m.createSceneTransition(),k.removeClass("hide"),m.exec("show",[]),setTimeout(function(){a.newInstance(k,l).play()},60)}}},g=function(a,b){this.id=a,this.albums=$("#"+a),this.relative=b||"body",this.albumList=this.albums.find('[data-type="album"]'),this.albumSize=this.albumList.length,this.currentIndex=0,this.nextIndex=0,this.prevIndex=0,this.lastIndex=0,this.currentZIndex=4,this.nextZIndex=3,this.prevZIndex=2,this.queueZIndex=1,this.photos=null,this.photoList=[],this.listener=new c({onshow:null,onhidden:null,onstart:null,onscrolling:null,onend:null})};g.prototype={exec:function(a,b){return this.listener.exec(a,b)},set:function(a,b){this.listener.set(a,b)},remove:function(a){this.listener.remove(a)},get:function(a){return this.listener.get(a)},clear:function(){this.listener.clear()},createSceneTransition:function(){var a=this,c=null,d=a.photos,e=a.photoList,f=d.attr("data-mode"),g=d.attr("data-scroll")||"horizontal",h=Number(d.attr("data-hidden")||"100");c=b.newInstance(e,f,g),c.set("shift",{callback:function(a,b,c,d,e,f,g,h,i,j){var k=Math.abs(d),l=Math.abs(e),m=!1,n=j.stage,o=null,p="!.5s ease-out;opacity:0!.4s ease-out";"horizontal"==h?(m=l>=i,o="transition::translate:"+(d>0?"100%,0":"-100%,0")+p):(m=k>=i,o="transition::translate:"+(e>0?"0,100%":"0,-100%")+p),m&&(n.one("webkitTransitionEnd","",{stage:n,albums:this},function(a){a.stopPropagation();var b=a.data;b.stage.addClass("hide"),b.albums.exec("hidden",[])}),n.css("opacity",0))},context:a,args:[g,h,c]})},create:function(){var b=this,c=b.albums.attr("data-in");if(c){var g=a.newInstance(b.albums,c);g.play()}b.albums.attr("data-relative",b.relative),e[b.id]=b,d.setActionHook(b.albums),d.injectAction(f)},destroy:function(){delete e[this.id]}},module.exports={newInstance:function(a,b){var c=new g(a,b);return{set:function(a,b){return c.set(a,b),this},create:function(){return c.create(),this},destroy:function(){return c.destroy(),this}}}}});