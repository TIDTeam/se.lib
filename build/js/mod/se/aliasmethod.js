/*! Copyright (c) SESHENGHUO.COM - Author: LIJUN - Email: zwlijun@gmail.com - Git: https://github.com/zwlijun/se.lib */
define(function(require,exports,module){require("mod/polyfill/array");var a=function(a){this.probabilityLength=0,this.probability=[],this.alias=[],this.init(a)};a.prototype={getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},scale:function(a){var b=a.reduce(function(a,b){return a+b});return b>1?a=a.map(function(a){return a/b}):1>b&&a.push(1-b),a},init:function(a){var b,c,d,e,f,g;if(null===a)throw new Error("Undefined Probabilities Array");if(this.probabilityLength=a.length,b=1/this.probabilityLength,this.probabilityLength<=0)throw new Error("Empty probabilities array");for(e=0;e<this.probabilityLength;e++)if(isNaN(parseFloat(a[e]))||!isFinite(a[e]))throw new Error("All elements in probabilities array must be numeric");for(a=a.slice(0),a=this.scale(a),this.probability=[],this.alias=[],c=[],d=[],e=0;e<a.length;e++)a[e]>=b?d.push(e):c.push(e);for(;c.length>0&&d.length>0;)f=c.shift(),g=d.shift(),this.probability[f]=a[f]*this.probabilityLength,this.alias[f]=g,a[g]=a[g]+a[f]-b,a[g]>=b?d.push(g):c.push(g);for(;0!==d.length;)this.probability[d.shift()]=1;for(;0!==c.length;)this.probability[c.shift()]=1},next:function(){var a,b;return a=this.getRandomInt(0,this.probabilityLength-1),b=Math.random()<this.probability[a],b?a:this.alias[a]}},module.exports=function(b){var c=new a(b);return{next:function(){return c.next()}}}});