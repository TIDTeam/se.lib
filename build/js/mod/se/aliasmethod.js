/*! Copyright (c) SESHENGHUO.COM - Author: LIJUN - Email: zwlijun@gmail.com */
define(function(require,exports,module){"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(a){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var b,c=Object(this),d=c.length>>>0,e=0;if(arguments.length>=2)b=arguments[1];else{for(;d>e&&!e in c;)e++;if(e>=d)throw new TypeError("Reduce of empty array with no initial value");b=c[e++]}for(;d>e;e++)e in c&&(b=a(b,c[e],e,c));return b}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null==this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=new Array(g),e=0;g>e;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d});var a=function(a){this.probabilityLength=0,this.probability=[],this.alias=[],this.init(a)};a.prototype={getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},scale:function(a){var b=a.reduce(function(a,b){return a+b});return b>1?a=a.map(function(a){return a/b}):1>b&&a.push(1-b),a},init:function(a){var b,c,d,e,f,g;if(null===a)throw new Error("Undefined Probabilities Array");if(this.probabilityLength=a.length,b=1/this.probabilityLength,this.probabilityLength<=0)throw new Error("Empty probabilities array");for(e=0;e<this.probabilityLength;e++)if(isNaN(parseFloat(a[e]))||!isFinite(a[e]))throw new Error("All elements in probabilities array must be numeric");for(a=a.slice(0),a=this.scale(a),this.probability=[],this.alias=[],c=[],d=[],e=0;e<a.length;e++)a[e]>=b?d.push(e):c.push(e);for(;c.length>0&&d.length>0;)f=c.shift(),g=d.shift(),this.probability[f]=a[f]*this.probabilityLength,this.alias[f]=g,a[g]=a[g]+a[f]-b,a[g]>=b?d.push(g):c.push(g);for(;0!==d.length;)this.probability[d.shift()]=1;for(;0!==c.length;)this.probability[c.shift()]=1},next:function(){var a,b;return a=this.getRandomInt(0,this.probabilityLength-1),b=Math.random()<this.probability[a],b?a:this.alias[a]}},module.exports=function(b){var c=new a(b);return{next:function(){return c.next()}}}});