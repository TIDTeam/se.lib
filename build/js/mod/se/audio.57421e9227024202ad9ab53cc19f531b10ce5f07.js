/*! Copyright (c) SESHENGHUO.COM - Author: LIJUN - Email: zwlijun@gmail.com - Git: https://github.com/zwlijun/se.lib */
define(function(require,exports,module){var a=require("mod/se/listener.263f38898829bcbd37b39b7743be119a9db33581"),b=function(){for(var a=["","webkit","moz","ms","O"],b=a.length,c="AudioContext",d=null,e=null,f=0;b>f;f++)if(d=a[f],e=d+c,e in window)return window[e];return void 0}(),c=function(){if(this.context=b?new b:void 0,this.audioList=[],this.size=0,this.playing=void 0,this.listener=new a({onerror:null,onload:null,oncomplete:null,ondecodesuccess:null,ondecodefail:null}),!this.context)throw new Error("you browser/device not support AudioContext!")};c.prototype={exec:function(a,b){return this.listener.exec(a,b)},set:function(a,b){this.listener.set(a,b)},remove:function(a){this.listener.remove(a)},get:function(a){return this.listener.get(a)},clear:function(){this.listener.clear()},load:function(a){this.audioList=a,this.size=this.audioList.length,this.loadAudioBuffer(0)},loadAudioBuffer:function(a){var b=new XMLHttpRequest,c=this,d=c.context,e=this.audioList[a],f=this.audioList[a+1];!e||e.buffer||e.source?(c.exec("load",[null,d]),c.exec("decodesuccess",[null,d,c.audioList[a]]),f?c.loadAudioBuffer(a+1):c.exec("complete",[null,d,c.audioList])):(b.open("GET",e.url,!0),b.responseType="arraybuffer",b.onload=function(e){c.exec("load",[e,d]),c.decode(b.response,a,f)},b.onerror=function(a){c.exec("error",[a,d])},b.send())},decode:function(a,b,c){var d=this,e=d.context;e.decodeAudioData(a,function(a){var f=e.createBufferSource();f.buffer=a,d.update(b,a,f),d.exec("decodesuccess",[null,e,d.audioList[b]]),c?d.loadAudioBuffer(b+1):d.exec("complete",[null,e,d.audioList])},function(a){d.update(b,null,null),d.exec("decodefail",[a,e,d.audioList[b]]),c?d.loadAudioBuffer(b+1):d.exec("complete",[null,e,d.audioList])})},update:function(a,b,c){this.audioList[a].buffer=b||null,this.audioList[a].source=c||null},play:function(a,b){var c=this.audioList[a||0],d=c.source;d&&(this.playing=!0,d.start(b||0))},stop:function(a,b){var c=this.audioList[a||0],d=c.source;d&&(this.playing=!1,d.stop(b||0))},pause:function(a){void 0===this.playing||!1===this.playing?this.play(a,this.context.currentTime):this.stop(a,this.context.currentTime)}};var d={newInstance:function(){var a=new c;return{context:a.context,set:function(b,c){return a.set(b,c),this},load:function(b){return a.load(b),this},play:function(b,c){return a.play(b,c),this},stop:function(b,c){return a.stop(b,c),this},pause:function(b){return a.pause(b),this}}}};module.exports=d});
