/*! Copyright (c) SESHENGHUO.COM - Author: LIJUN - Email: zwlijun@gmail.com - Git: https://github.com/zwlijun/se.lib */
define(function(require,exports,module){require("mod/zepto/touch.e960be16676e977765ed45c5f7aaed29eb0160d4"),require("mod/zepto/fx.973398a0d0f2ca3f3f4971252e8811075057088a");var a=$.Util=require("mod/se/util.5418ba8bf71f527f29091bc874d170aac4af716b"),b=window.innerWidth,c=window.innerHeight,d=b,e=c,f=b,g=c,h=b,i=c,j='<div id="card_${index}" class="card js-card" data-index="${index}" style="width:${width}px; height:${height}px;$!{styles}"><div id="card_inner_${index}" class="card-inner js-card-inner" data-index="${index}" style="$!{innerStyles}"><!-- dynamic html(${index}) -->$!{content}$!{widgets}</div></div>',k='<script name="widget_${cardIndex}" type="text/template"><div id="widget_${cardIndex}_${index}" class="card-widget" data-widget="${index}">$!{html}</div></script>',l={uniqueId:null,stage:null,panel:null,options:null,size:0,index:0,currentIndex:0,cardIndex:0,loop:!0,scrolling:!1,next:!0,where:-1,dir:0,setCurrentIndex:function(a){this.where=0,a>=this.size?(a=this.size-1,this.where=1):0>=a&&(a=0,this.where=-1),this.currentIndex=a},getCurrentIndex:function(){return this.currentIndex},getWidges:function(b,c){for(var d=[],e=c.widgets||[],f=e.length,g=null,h=0;f>h;h++)g=e[h],d.push(a.formatData(k,{cardIndex:b,index:h,html:g.html||""}));return d.join("")},getStyles:function(a){var b=a.css||{},c=[];for(var d in b)b.hasOwnProperty(d)&&c.push(d+":"+b[d]);return c.join("; ")},setSize:function(a,d){b=a,c=d},setInnerSize:function(a,b){d=a,e=b},setMaxInnerSize:function(a,b){f=a,g=b},setMinInnerSize:function(a,b){h=a,i=b},getInnerStyles:function(){var a={width:d,height:e,"max-width":f,"max-height":g,"min-width":h,"min-height":i},b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+":"+a[c]+"px");return b.join("; ")},newCard:function(d,e){var f=this.getWidges(d,e),g=this.getStyles(e),h=this.getInnerStyles(),i=a.formatData(j,{index:d,width:b,height:c,styles:g,innerStyles:h,content:e.content||"",widgets:f});return i},getWidget:function(a,b){var c=this.options[a]||{},d=c.widgets||[],e=d[b]||{};return e},getWidgetProperty:function(a,b,c){var d=this.getWidget(a,b),e=d[c]||null;return e},getWidgetAnimate:function(a,b){return this.getWidgetProperty(a,b,"animate")},getWidgetStyles:function(a,b){return this.getWidgetProperty(a,b,"styles")},getWidgetDelay:function(a,b){return this.getWidgetProperty(a,b,"delay")},showWidget:function(b,c){var d=$('script[name="widget_'+b+'"]'),e=d.length,f=$("#card_inner_"+b),g=[],h=null,i=null,j=null,k=null,m=null;if(e>0){if(!1===c&&(f.find(".card-widget").remove(),f.data("widget",0),f.data("set",0)),"1"!=f.data("widget")){for(var n=0;e>n;n++)g.push(d[n].innerHTML);f.append(g.join("")),f.data("widget",1)}if("1"!=f.data("set")){for(var o=0;e>o;o++){if(h=$("#widget_"+b+"_"+o),k=l.getWidgetDelay(b,o),j=l.getWidgetStyles(b,o),i=l.getWidgetAnimate(b,o),k&&a.execAfterMergerHandler(k.handler,[h]),j&&j instanceof Object)for(var p in j)j.hasOwnProperty(p)&&(m=j[p],"className"==p?h.addClass(m):"hash"==p?h.css(m):h.css(p,m));i&&i instanceof Array&&h.animate.apply(h,i)}f.data("set",1)}}},configure:function(a,b,c){var d=a||[];!0===b&&d.push(d[0]);var e=d.length;this.index=0,this.currentIndex=0,this.options=d,this.size=e,this.loop=b,this.next=!0,this.frame=c||"body"},position:function(d,e,f){var g=this.dir,h="margin-"+(0===g?"top":"left"),i=0===g?c:b,j={},k=this.complete(f),m=k.args;this.setCurrentIndex(d),this.next=!0,this.scrolling=!0,k.args=[],j[h]=-i*l.getCurrentIndex()+"px",this.panel.animate(j,e||"fast","ease-in",function(){var b=l.getCurrentIndex();k.args=[],a.execAfterMergerHandler(k,[b].concat(m)),b=l.getCurrentIndex(),l.setCurrentIndex(++b),l.scrolling=!1})},resize:function(b){$(window).on("resize",function(){a.execHandler(b)})},destroy:function(){this.stage.remove()},trace:function(a,d,e){this.dir=d=d||this.dir;var f=0===d?b:b*this.size,g=0===d?c*this.size:c,h=[];e=this.index+e||this.size,this.cardIndex>=e&&(e=this.cardIndex+1),0==$("#"+a+"_stage").length&&$(this.frame).append('<div id="'+a+'_stage" class="card-stage" style="width:'+b+"px; height:"+c+'px;">  <div id="'+a+'" class="card-container" style="width:'+f+"px; height:"+g+'px;">  </div></div>');for(var i=this.index;i<this.size&&e>i;i++)this.index=i+1,h.push(this.newCard(i,this.options[i]));this.uniqueId=a,this.stage=$("#"+a+"_stage"),this.panel=$("#"+a),this.panel.append(h.join(""))},zero:function(){var a=0===this.dir?"top":"left";this.setCurrentIndex(0),this.next=!0,this.panel.css("margin-"+a,"0px")},complete:function(a){var b=a||{},c=b.callback||null,d=b.context||null,e=this.size,f=this.loop;return b.callback=function(){var a=arguments,b=a[0];c.apply(d,a),b>=e-1&&!0===f&&l.zero()},b},undo:function(a){var b=this.getCurrentIndex();console.info("undo: "+b+"; "+a+"; "+this.where),!0===a?this.next!=a?(this.setCurrentIndex(++b),console.info("up/undo: "+this.getCurrentIndex())):0===b&&this.setCurrentIndex(++b):this.next!=a&&(this.setCurrentIndex(1===this.where?--b:b-2),console.info("down/undo: "+this.getCurrentIndex())),this.next=a},getSwipeOffset:function(){return 0===this.dir?c:b},swipeForward:function(b,c,d){var e=this.dir,f="margin-"+(0===e?"top":"left"),g="swipe"+(0===e?"Up":"Left");$(document)[g](function(){if(console.info("forward start"),l.undo(!0),!1===l.scrolling){l.scrolling=!0;var e=l.cardIndex=l.getCurrentIndex(),g=l.getSwipeOffset(),h={};h[f]=-g*e+"px",l.panel.animate(h,b||"fast","ease-in",function(){console.info("forward end");var b=e;c.args=[],a.execAfterMergerHandler(c,[b].concat(d)),b=l.getCurrentIndex(),l.setCurrentIndex(++b),l.scrolling=!1})}})},swipeBack:function(b,c,d){var e=this.dir,f="margin-"+(0===e?"top":"left"),g="swipe"+(0===e?"Down":"Right");$(document)[g](function(){if(console.info("back start"),l.undo(!1),!1===l.scrolling){l.scrolling=!0;var e=l.cardIndex=l.getCurrentIndex(),g=l.getSwipeOffset(),h={};h[f]=-g*e+"px",l.panel.animate(h,b||"fast","ease-in",function(){console.info("back end");var b=e;c.args=[],a.execAfterMergerHandler(c,[b].concat(d)),b=l.getCurrentIndex(),l.setCurrentIndex(--b),l.scrolling=!1})}})},swipe:function(a,b,c){var d=this.complete(b),e=d.args;d.args=[],$(document).on("touchmove",function(a){a.preventDefault()}),this.dir=c=c||this.dir,this.swipeForward(a,d,e),this.swipeBack(a,d,e)}},m={width:b,height:c,size:l.size,getCardIndex:function(){return l.cardIndex},isForward:function(){return l.next},configure:function(a,d,e,f){return l.configure(a,!!d,e||b,f||c),this.size=l.size,this},trace:function(a,b,c){return l.trace(a,b,c),this},swipe:function(a,b,c){return l.swipe(a,b,c||0),this},position:function(a,b,c){return l.position(a,b,c),this},showWidget:function(a,b){return l.showWidget(a,!!b),this},setSize:function(a,b){return this.width=a,this.height=b,l.setSize(a,b),this},setInnerSize:function(a,b){return l.setInnerSize(a,b),this},setMaxInnerSize:function(a,b){return l.setMaxInnerSize(a,b),this},setMinInnerSize:function(a,b){return l.setMinInnerSize(a,b),this},resize:function(a){return l.resize(a),this},destroy:function(){return l.destroy(),this}};module.exports=m});
